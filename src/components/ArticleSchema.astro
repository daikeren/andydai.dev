---
/**
 * ArticleSchema - AEO 優化的結構化資料組件
 *
 * 支援：
 * - Article schema (基本文章)
 * - FAQPage schema (常見問題)
 * - Person schema (作者資訊)
 */

import { themeConfig } from '@/config'

interface FAQ {
  question: string
  answer: string
}

interface Props {
  title: string
  description: string
  published: Date
  updated?: Date
  slug: string
  tags?: string[]
  faqs?: FAQ[]
}

const { title, description, published, updated, slug, tags = [], faqs = [] } = Astro.props
const { author, url: siteUrl } = themeConfig.site

// Article Schema
const articleSchema = {
  '@context': 'https://schema.org',
  '@type': 'Article',
  headline: title,
  description: description,
  datePublished: published.toISOString(),
  dateModified: (updated || published).toISOString(),
  author: {
    '@type': 'Person',
    name: author,
    url: `${siteUrl}/about/`,
    sameAs: themeConfig.footer.links
      .filter((link: { name: string }) => ['GitHub', 'X', 'LinkedIn'].includes(link.name))
      .map((link: { url: string }) => link.url),
  },
  publisher: {
    '@type': 'Organization',
    name: themeConfig.site.title,
    url: siteUrl,
  },
  mainEntityOfPage: {
    '@type': 'WebPage',
    '@id': `${siteUrl}/posts/${slug}/`,
  },
  keywords: tags.join(', '),
}

// FAQ Schema (如果有提供 FAQs)
const faqSchema = faqs.length > 0
  ? {
      '@context': 'https://schema.org',
      '@type': 'FAQPage',
      mainEntity: faqs.map(faq => ({
        '@type': 'Question',
        name: faq.question,
        acceptedAnswer: {
          '@type': 'Answer',
          text: faq.answer,
        },
      })),
    }
  : null
---

<script is:inline type="application/ld+json" set:html={JSON.stringify(articleSchema)} />
{faqSchema && <script is:inline type="application/ld+json" set:html={JSON.stringify(faqSchema)} />}
